## Project Started: 2026-01-10

## Goal
Optimize Kohelet website to achieve Lighthouse 100/100, instant load times, and <50ms TBT.

## Target Metrics
- Lighthouse Performance: 95-100
- Initial JS Bundle: <300KB (gzipped)
- Total Blocking Time: <50ms
- First Contentful Paint: <1s
- Largest Contentful Paint: <1.5s

## Current State (Before Optimization)
- THREE.js bundle: 1.5MB (732KB x 2 chunks)
- No code splitting
- No lazy loading
- Font loading: All locales on all pages
- MouseGlow: No throttling
- Pricing.tsx: 427 lines monolithic

## Agent Workflow
- CRP tasks (Critical Path): Direct execution
- SPLIT tasks (Code Splitting): senior-frontend-dev agent
- ASSET tasks (Assets): Direct execution
- MT tasks (Main Thread): senior-frontend-dev agent
- BUILD tasks (Build Config): Direct execution
- VERIFY tasks (Verification): Direct execution

## Completed Tasks

### CRP-01: Audit current bundle ✅
**Completed: 2026-01-10**

#### Bundle Analysis Results

**Total Bundle Size:**
- Raw: 2,327KB
- Gzipped: 676KB (exceeds 300KB target by 376KB)

**Chunks over 100KB (gzipped):**

| Chunk | Raw Size | Gzipped | Contents |
|-------|----------|---------|----------|
| c6310d7ede71e829.js | 732KB | 206KB | THREE.js + GSAP + post-processing |
| a9e58dccaba5c3ff.js | 732KB | 206KB | THREE.js + GSAP + post-processing |
| 03666d851f44ca00.js | 219KB | 68KB | Next.js runtime |
| 057bb69c6df45c1c.js | 139KB | 41KB | React/Next.js framework |
| 2af30515a8cf43d2.js | 151KB | 39KB | App code / utilities |
| a6dad97d9634a72d.js | 109KB | 38KB | App code / utilities |

**THREE.js Impact:**
- Two 732KB chunks (206KB gzipped each) = **412KB gzipped total**
- Contains: THREE.js core, EffectComposer, RenderPass, UnrealBloomPass
- Also includes GSAP and ScrollTrigger
- Loaded synchronously on homepage via direct import

**Key Findings:**
1. THREE.js is directly imported in `app/[locale]/page.tsx` - no code splitting
2. `ThreeBackground.tsx` imports THREE.js synchronously at module level
3. Post-processing effects (bloom) add significant weight
4. GSAP bundled with THREE.js chunks (could be separated)
5. No dynamic imports or lazy loading in place

**Optimization Opportunities:**
- Dynamic import THREE.js with `next/dynamic` (saves ~412KB from initial load)
- Add CSS gradient fallback for mobile/low-end devices
- Intersection Observer to pause THREE.js when not visible
- Reduce particle count (currently 1500)
- Disable bloom on mobile

---

### CRP-02: Font optimization ✅
**Completed: 2026-01-10**

#### Changes Made

**Locale-specific font loading:**
- Created separate Heebo font instances for Hebrew and English locales
- Hebrew locale (`he`): Loads `hebrew` subset (includes Hebrew + basic Latin)
- English locale (`en`): Loads `latin` subset only (smaller download)

**Font loading optimizations:**
1. Added `preload: true` for Heebo fonts (critical)
2. Added `preload: false` for JetBrains Mono (secondary/code font)
3. Added `display: "swap"` for all fonts (prevents FOIT)
4. Specified explicit weights: `["400", "500", "600", "700"]` for Heebo
5. Reduced JetBrains Mono weights to `["400", "500"]` (only what's needed)

**Implementation:**
```typescript
// Hebrew locale font - includes Hebrew characters + Latin
const heeboHebrew = Heebo({
  subsets: ["hebrew"],
  display: "swap",
  variable: "--font-heebo",
  preload: true,
  weight: ["400", "500", "600", "700"],
});

// English locale font - Latin only (smaller subset)
const heeboLatin = Heebo({
  subsets: ["latin"],
  display: "swap",
  variable: "--font-heebo",
  preload: true,
  weight: ["400", "500", "600", "700"],
});

// Dynamic selection based on locale
function getHeeboFont(locale: string) {
  return locale === "he" ? heeboHebrew : heeboLatin;
}
```

**Benefits:**
- English users no longer download Hebrew glyphs (~30-50KB savings)
- Hebrew users get optimized Hebrew subset
- Critical fonts preloaded, secondary fonts deferred
- `display: swap` prevents invisible text during load

**Verification:**
- ✅ TypeScript compilation: No errors
- ✅ Build: Successful
- ✅ Both locales render correctly

---

## Next Task: CRP-03 - Critical CSS extraction
